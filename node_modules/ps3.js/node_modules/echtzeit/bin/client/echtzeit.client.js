/*
                         _      __ 
           ___  ___ ____(_)__  / /_
          / _ \/ -_) __/ / _ \/ __/
         / .__/\__/_/ /_/_//_/\__/ 
        /_/                        

        Copyright (c) 2014 by perint and Kenan Sulayman. All Rights Reserved.

        [Portions/Faye] Copyright (c) 2009-2013 James Coglan and contributors
 
        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:
 
        The above copyright notice and this permission notice shall be included in
        all copies or substantial portions of the Software.
 
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
        THE SOFTWARE.

        @preserve
*/
"use strict";var echtzeit={VERSION:"1.6.4",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"ezd",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,fireback:!0,extend:function(t,e,i){if(!e)return t;for(var n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)&&i===!1||t[n]!==e[n]&&(t[n]=e[n]));return t},random:function(t){t=t||this.ID_LENGTH;for(var e=Math.ceil(t*Math.log(2)/Math.log(36)),i=csprng(t,36);i.length<e;)i="0"+i;return i},clientIdFromMessages:function(t){var e=this.filter([].concat(t),function(t){return"/meta/connect"===t.channel});return e[0]&&e[0].clientId},copyObject:function(t){var e,i,n;if(t instanceof Array){for(e=[],i=t.length;i--;)e[i]=echtzeit.copyObject(t[i]);return e}if("object"==typeof t){e=null===t?null:{};for(n in t)e[n]=echtzeit.copyObject(t[n]);return e}return t},commonElement:function(t,e){for(var i=0,n=t.length;n>i;i++)if(-1!==this.indexOf(e,t[i]))return t[i];return null},indexOf:function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},map:function(t,e,i){if(t.map)return t.map(e,i);var n=[];if(t instanceof Array)for(var s=0,r=t.length;r>s;s++)n.push(e.call(i||null,t[s],s));else for(var o in t)t.hasOwnProperty(o)&&n.push(e.call(i||null,o,t[o]));return n},filter:function(t,e,i){if(t.filter)return t.filter(e,i);for(var n=[],s=0,r=t.length;r>s;s++)e.call(i||null,t[s],s)&&n.push(t[s]);return n},asyncEach:function(t,e,i,n){var s=t.length,r=-1,o=0,c=!1,h=function(){return o-=1,r+=1,r===s?i&&i.call(n):void e(t[r],u)},a=function(){if(!c){for(c=!0;o>0;)h();c=!1}},u=function(){o+=1,a()};u()},toJSON:function(t){return this.stringify?this.stringify(t,function(t,e){return this[t]instanceof Array?this[t]:e}):JSON.stringify(t)}};echtzeit.Class=function(t,e){"function"!=typeof t&&(e=t,t=Object);var i=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},n=function(){};return n.prototype=t.prototype,i.prototype=new n,echtzeit.extend(i.prototype,e),i},function(){function t(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1}var e=echtzeit.EventEmitter=function(){},i="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};e.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||i(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);e.apply(this,n)}return!0}if(i(e)){for(var n=Array.prototype.slice.call(arguments,1),s=e.slice(),r=0,o=s.length;o>r;r++)s[r].apply(this,n);return!0}return!1},e.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",t,e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(t,e){var i=this;return i.on(t,function n(){i.removeListener(t,n),e.apply(this,arguments)}),this},e.prototype.removeListener=function(e,n){if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var s=this._events[e];if(i(s)){var r=t(s,n);if(0>r)return this;s.splice(r,1),0==s.length&&delete this._events[e]}else this._events[e]===n&&delete this._events[e];return this},e.prototype.removeAllListeners=function(t){return 0===arguments.length?(this._events={},this):(t&&this._events&&this._events[t]&&(this._events[t]=null),this)},e.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),i(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}(),echtzeit.Namespace=echtzeit.Class({initialize:function(){this._used={}},exists:function(t){return this._used.hasOwnProperty(t)},generate:function(){for(var t=echtzeit.random();this._used.hasOwnProperty(t);)t=echtzeit.random();return this._used[t]=t},release:function(t){delete this._used[t]}}),function(){var t,e=setTimeout;t="function"==typeof setImmediate?function(t){setImmediate(t)}:"object"==typeof process&&process.nextTick?function(t){process.nextTick(t)}:function(t){e(t,0)};var i=0,n=1,s=2,r=function(t){return t},o=function(t){throw t},c=function(t){if(this._state=i,this._callbacks=[],this._errbacks=[],"function"==typeof t){var e=this;t(function(t){f(e,t)},function(t){p(e,t)})}};c.prototype.then=function(t,e){var i={},n=this;return i.promise=new c(function(s,r){i.fulfill=s,i.reject=r,h(n,t,i),a(n,e,i)}),i.promise};var h=function(t,e,s){"function"!=typeof e&&(e=r);var o=function(t){u(e,t,s)};t._state===i?t._callbacks.push(o):t._state===n&&o(t._value)},a=function(t,e,n){"function"!=typeof e&&(e=o);var r=function(t){u(e,t,n)};t._state===i?t._errbacks.push(r):t._state===s&&r(t._reason)},u=function(e,i,n){t(function(){l(e,i,n)})},l=function(t,e,i){var n,s,o,c=!1;try{if(n=t(e),s=typeof n,o=null!==n&&("function"===s||"object"===s)&&n.then,n===i.promise)return i.reject(new TypeError("Recursive promise chain detected"));if("function"!=typeof o)return i.fulfill(n);o.call(n,function(t){c||(c=!0,l(r,t,i))},function(t){c||(c=!0,i.reject(t))})}catch(h){if(c)return;c=!0,i.reject(h)}},f=c.fulfill=c.resolve=function(t,e){if(t._state===i){t._state=n,t._value=e,t._errbacks=[];for(var s,r=t._callbacks;s=r.shift();)s(e)}},p=c.reject=function(t,e){if(t._state===i){t._state=s,t._reason=e,t._callbacks=[];for(var n,r=t._errbacks;n=r.shift();)n(e)}};c.defer=t,c.deferred=c.pending=function(){var t={};return t.promise=new c(function(e,i){t.fulfill=t.resolve=e,t.reject=i}),t},c.fulfilled=c.resolved=function(t){return new c(function(e,i){e(t)})},c.rejected=function(t){return new c(function(e,i){i(t)})},"undefined"==typeof echtzeit?module.exports=c:echtzeit.Promise=c}(),echtzeit.Set=echtzeit.Class({initialize:function(){this._index={}},add:function(t){var e=void 0!==t.id?t.id:t;return this._index.hasOwnProperty(e)?!1:(this._index[e]=t,!0)},forEach:function(t,e){for(var i in this._index)this._index.hasOwnProperty(i)&&t.call(e,this._index[i])},isEmpty:function(){for(var t in this._index)if(this._index.hasOwnProperty(t))return!1;return!0},member:function(t){for(var e in this._index)if(this._index[e]===t)return!0;return!1},remove:function(t){var e=void 0!==t.id?t.id:t,i=this._index[e];return delete this._index[e],i},toArray:function(){var t=[];return this.forEach(function(e){t.push(e)}),t}}),echtzeit.URI={isURI:function(t){return t&&t.protocol&&t.host&&t.path},isSameOrigin:function(t){var e=echtzeit.ENV.location;return t.protocol===e.protocol&&t.hostname===e.hostname&&t.port===e.port},parse:function(t){if("string"!=typeof t)return t;var e,i,n,s,r,o,c={},h=function(e,i){t=t.replace(i,function(t){return c[e]=t,""}),c[e]=c[e]||""};for(h("protocol",/^[a-z]+\:/i),h("host",/^\/\/[^\/\?#]+/),/^\//.test(t)||c.host||(t=echtzeit.ENV.location.pathname.replace(/[^\/]*$/,"")+t),h("pathname",/^[^\?#]*/),h("search",/^\?[^#]*/),h("hash",/^#.*/),c.protocol=c.protocol||echtzeit.ENV.location.protocol,c.host?(c.host=c.host.substr(2),e=c.host.split(":"),c.hostname=e[0],c.port=e[1]||""):(c.host=echtzeit.ENV.location.host,c.hostname=echtzeit.ENV.location.hostname,c.port=echtzeit.ENV.location.port),c.pathname=c.pathname||"/",c.path=c.pathname+c.search,i=c.search.replace(/^\?/,""),n=i?i.split("&"):[],o={},s=0,r=n.length;r>s;s++)e=n[s].split("="),o[decodeURIComponent(e[0]||"")]=decodeURIComponent(e[1]||"");return c.query=o,c.href=this.stringify(c),c},stringify:function(t){var e=t.protocol+"//"+t.hostname;return t.port&&(e+=":"+t.port),e+=t.pathname+this.queryString(t.query)+(t.hash||"")},queryString:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return 0===e.length?"":"?"+e.join("&")}},echtzeit.Error=echtzeit.Class({initialize:function(t,e,i){this.code=t,this.params=Array.prototype.slice.call(e),this.message=i},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),echtzeit.Error.parse=function(t){if(t=t||"",!echtzeit.Grammar.ERROR.test(t))return new this(null,[],t);var e=t.split(":"),i=parseInt(e[0]),n=e[1].split(","),t=e[2];return new this(i,n,t)},echtzeit.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},echtzeit.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},echtzeit.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},echtzeit.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},echtzeit.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},echtzeit.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},echtzeit.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},echtzeit.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},echtzeit.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},echtzeit.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},echtzeit.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},echtzeit.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},echtzeit.Deferrable={then:function(t,e){var i=this;return this._promise||(this._promise=new echtzeit.Promise(function(t,e){i._fulfill=t,i._reject=e})),0===arguments.length?this._promise:this._promise.then(t,e)},callback:function(t,e){return this.then(function(i){t.call(e,i)})},errback:function(t,e){return this.then(null,function(i){t.call(e,i)})},timeout:function(t,e){this.then();var i=this;this._timer=echtzeit.ENV.setTimeout(function(){i._reject(e)},1e3*t)},setDeferredStatus:function(t,e){this._timer&&echtzeit.ENV.clearTimeout(this._timer),this.then(),"succeeded"===t?this._fulfill(e):"failed"===t?this._reject(e):delete this._promise}},echtzeit.Publisher={countListeners:function(t){return this.listeners(t).length},bind:function(t,e,i){var n=Array.prototype.slice,s=function(){e.apply(i,n.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([t,e,i,s]),this.on(t,s)},unbind:function(t,e,i){this._listeners=this._listeners||[];for(var n,s=this._listeners.length;s--;)n=this._listeners[s],n[0]===t&&(!e||n[1]===e&&n[2]===i)&&(this._listeners.splice(s,1),this.removeListener(t,n[3]))}},echtzeit.extend(echtzeit.Publisher,echtzeit.EventEmitter.prototype),echtzeit.Publisher.trigger=echtzeit.Publisher.emit,echtzeit.Timeouts={addTimeout:function(t,e,i,n){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(t)){var s=this;this._timeouts[t]=echtzeit.ENV.setTimeout(function(){delete s._timeouts[t],i.call(n)},1e3*e)}},removeTimeout:function(t){this._timeouts=this._timeouts||{};var e=this._timeouts[t];e&&(echtzeit.ENV.clearTimeout(e),delete this._timeouts[t])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var t in this._timeouts)this.removeTimeout(t)}},echtzeit.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(t,e){if(echtzeit.logger){var i=Array.prototype.slice.apply(t),n="[echtzeit",s=this.className,r=i.shift().replace(/\?/g,function(){try{return echtzeit.toJSON(i.shift())}catch(t){return"[Object]"}});for(var o in echtzeit)s||"function"==typeof echtzeit[o]&&this instanceof echtzeit[o]&&(s=o);s&&(n+="."+s),n+="] ","function"==typeof echtzeit.logger[e]?echtzeit.logger[e](n+r):"function"==typeof echtzeit.logger&&echtzeit.logger(n+r)}}},function(){for(var t in echtzeit.Logging.LOG_LEVELS)(function(t){echtzeit.Logging[t]=function(){this.writeLog(arguments,t)}})(t)}(),echtzeit.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},echtzeit.Extensible={addExtension:function(t){this._extensions=this._extensions||[],this._extensions.push(t),t.added&&t.added(this)},removeExtension:function(t){if(this._extensions)for(var e=this._extensions.length;e--;)this._extensions[e]===t&&(this._extensions.splice(e,1),t.removed&&t.removed(this))},pipeThroughExtensions:function(t,e,i,n,s){if(this.debug("Passing through ? extensions: ?",t,e),!this._extensions)return n.call(s,e);var r=this._extensions.slice(),o=function(e){if(!e)return n.call(s,e);var c=r.shift();if(!c)return n.call(s,e);var h=c[t];return h?void(h.length>=3?c[t](e,i,o):c[t](e,o)):o(e)};o(e)}},echtzeit.extend(echtzeit.Extensible,echtzeit.Logging),echtzeit.Channel=echtzeit.Class({initialize:function(t){this.id=this.name=t},push:function(t){this.trigger("message",t)},isUnused:function(){return 0===this.countListeners("message")}}),echtzeit.extend(echtzeit.Channel.prototype,echtzeit.Publisher),echtzeit.extend(echtzeit.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(t){var e=this.parse(t),i=["/**",t],n=e.slice();n[n.length-1]="*",i.push(this.unparse(n));for(var s=1,r=e.length;r>s;s++)n=e.slice(0,s),n.push("**"),i.push(this.unparse(n));return i},isValid:function(t){return echtzeit.Grammar.CHANNEL_NAME.test(t)||echtzeit.Grammar.CHANNEL_PATTERN.test(t)},parse:function(t){return this.isValid(t)?t.split("/").slice(1):null},unparse:function(t){return"/"+t.join("/")},isMeta:function(t){var e=this.parse(t);return e?e[0]===this.META:null},isService:function(t){var e=this.parse(t);return e?e[0]===this.SERVICE:null},isSubscribable:function(t){return this.isValid(t)?!this.isMeta(t)&&!this.isService(t):null},Set:echtzeit.Class({initialize:function(){this._channels={}},getKeys:function(){var t=[];for(var e in this._channels)t.push(e);return t},remove:function(t){delete this._channels[t]},hasSubscription:function(t){return this._channels.hasOwnProperty(t)},subscribe:function(t,e,i){for(var n,s=0,r=t.length;r>s;s++){n=t[s];var o=this._channels[n]=this._channels[n]||new echtzeit.Channel(n);e&&o.bind("message",e,i)}},unsubscribe:function(t,e,i){var n=this._channels[t];return n?(n.unbind("message",e,i),n.isUnused()?(this.remove(t),!0):!1):!1},distributeMessage:function(t){for(var e=echtzeit.Channel.expand(t.channel),i=0,n=e.length;n>i;i++){var s=this._channels[e[i]];s&&s.trigger("message",t.data)}}})}),echtzeit.Publication=echtzeit.Class(echtzeit.Deferrable),echtzeit.Subscription=echtzeit.Class({initialize:function(t,e,i,n){this._client=t,this._channels=e,this._callback=i,this._context=n,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),echtzeit.extend(echtzeit.Subscription.prototype,echtzeit.Deferrable),echtzeit.Client=echtzeit.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/ez",INTERVAL:0,initialize:function(t,e){this.info("New client created for ?",t),e=e||{},this._endpoint=t||this.DEFAULT_ENDPOINT,this._channels=new echtzeit.Channel.Set,this._dispatcher=new echtzeit.Dispatcher(this,this._endpoint,e),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(e.interval||this.INTERVAL),timeout:1e3*(e.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),echtzeit.Event&&void 0!==echtzeit.ENV.onbeforeunload&&echtzeit.Event.on(echtzeit.ENV,"beforeunload",function(){echtzeit.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},disable:function(t){return this._dispatcher.disable(t)},setHeader:function(t,e){return this._dispatcher.setHeader(t,e)},handshake:function(t,e){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var i=this;this.info("Initiating handshake with ?",echtzeit.URI.stringify(this._endpoint)),this._dispatcher.selectTransport(echtzeit.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:echtzeit.Channel.HANDSHAKE,version:echtzeit.BAYEUX_VERSION,supportedConnectionTypes:[this._dispatcher.connectionType]},{},function(n){n.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=n.clientId,this._dispatcher.selectTransport(n.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),t&&echtzeit.Promise.defer(function(){t.call(e)})):(this.info("Handshake unsuccessful"),echtzeit.ENV.setTimeout(function(){i.handshake(t,e)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(t,e){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(t,e)},this);this.callback(t,e),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:echtzeit.Channel.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId),this._sendMessage({channel:echtzeit.Channel.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful&&this._dispatcher.close()},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new echtzeit.Channel.Set)},subscribe:function(t,e,i){if(t instanceof Array)return echtzeit.map(t,function(t){return this.subscribe(t,e,i)},this);var n=new echtzeit.Subscription(this,t,e,i),s=e===!0,r=this._channels.hasSubscription(t);return r&&!s?(this._channels.subscribe([t],e,i),n.setDeferredStatus("succeeded"),n):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,t),s||this._channels.subscribe([t],e,i),this._sendMessage({channel:echtzeit.Channel.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:t},{},function(s){if(!s.successful)return n.setDeferredStatus("failed",echtzeit.Error.parse(s.error)),this._channels.unsubscribe(t,e,i);var r=[].concat(s.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,r),n.setDeferredStatus("succeeded")},this)},this),n)},unsubscribe:function(t,e,i){if(t instanceof Array)return echtzeit.map(t,function(t){return this.unsubscribe(t,e,i)},this);var n=this._channels.unsubscribe(t,e,i);n&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,t),this._sendMessage({channel:echtzeit.Channel.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:t},{},function(t){if(t.successful){var e=[].concat(t.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,e)}},this)},this)},publish:function(t,e,i){var n=new echtzeit.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,t,e),this._sendMessage({channel:t,data:e,clientId:this._dispatcher.clientId},i,function(t){t.successful?n.setDeferredStatus("succeeded"):n.setDeferredStatus("failed",echtzeit.Error.parse(t.error))},this)},this),n},_sendMessage:function(t,e,i,n){t.id=this._generateMessageId();var s=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",t,null,function(t){t&&(i&&(this._responseCallbacks[t.id]=[i,n]),this._dispatcher.sendMessage(t,s,e||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(t){var e,i=t.id;void 0!==t.successful&&(e=this._responseCallbacks[i],delete this._responseCallbacks[i]),this.pipeThroughExtensions("incoming",t,null,function(t){t&&(t.advice&&this._handleAdvice(t.advice),this._deliverMessage(t),e&&e[0].call(e[1],t))},this)},_handleAdvice:function(t){echtzeit.extend(this._advice,t),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(t){t.channel&&void 0!==t.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,t.channel,t.data),this._channels.distributeMessage(t))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var t=this;echtzeit.ENV.setTimeout(function(){t.connect()},this._advice.interval)}}),echtzeit.extend(echtzeit.Client.prototype,echtzeit.Deferrable),echtzeit.extend(echtzeit.Client.prototype,echtzeit.Publisher),echtzeit.extend(echtzeit.Client.prototype,echtzeit.Logging),echtzeit.extend(echtzeit.Client.prototype,echtzeit.Extensible),echtzeit.Dispatcher=echtzeit.Class({MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(t,e,i){this._client=t,this.endpoint=echtzeit.URI.parse(e),this._alternates=i.endpoints||{},this.ca=i.ca,this.cookies=echtzeit.Cookies&&new echtzeit.Cookies.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=i.retry||this.DEFAULT_RETRY,this._state=0,this.transports={};for(var n in this._alternates)this._alternates[n]=echtzeit.URI.parse(this._alternates[n]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(t){return this._alternates[t]||this.endpoint},disable:function(t){this._disabled.push(t)},setHeader:function(t,e){this.headers[t]=e},close:function(){var t=this._transport;delete this._transport,t&&t.close()},selectTransport:function(t){echtzeit.Transport.get(this,t,this._disabled,function(t){this.debug("Selected ? transport for ?",t.connectionType,echtzeit.URI.stringify(t.endpoint)),t!==this._transport&&(this._transport&&this._transport.close(),this._transport=t,this.connectionType=t.connectionType)},this)},sendMessage:function(t,e,i){if(this._transport){i=i||{};var n=this,s=t.id,r=i.attempts,o=i.deadline&&(new Date).getTime()+1e3*i.deadline,c=this._envelopes[s]=this._envelopes[s]||{message:t,timeout:e,attempts:r,deadline:o};if(!c.request&&!c.timer){if(this._attemptsExhausted(c)||this._deadlinePassed(c))return void delete this._envelopes[s];c.timer=echtzeit.ENV.setTimeout(function(){n.handleError(t)},1e3*e),c.request=this._transport.sendMessage(t)}}},handleResponse:function(t){var e=this._envelopes[t.id];void 0!==t.successful&&e&&(delete this._envelopes[t.id],echtzeit.ENV.clearTimeout(e.timer)),this.trigger("message",t),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(t,e){var i=this._envelopes[t.id],n=i&&i.request,s=this;n&&(n.then(function(t){t&&t.abort&&t.abort()}),echtzeit.ENV.clearTimeout(i.timer),i.request=i.timer=null,e?this.sendMessage(i.message,i.timeout):i.timer=echtzeit.ENV.setTimeout(function(){i.timer=null,s.sendMessage(i.message,i.timeout)},1e3*this.retry),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down")))},_attemptsExhausted:function(t){return void 0===t.attempts?!1:(t.attempts-=1,t.attempts>=0?!1:!0)},_deadlinePassed:function(t){var e=t.deadline;return void 0===e?!1:(new Date).getTime()<=e?!1:!0}}),echtzeit.extend(echtzeit.Dispatcher.prototype,echtzeit.Publisher),echtzeit.extend(echtzeit.Dispatcher.prototype,echtzeit.Logging),echtzeit.Transport=echtzeit.extend(echtzeit.Class({MAX_DELAY:0,batching:!0,initialize:function(t,e){this._dispatcher=t,this.endpoint=e,this._outbox=[]},close:function(){},encode:function(t){return""},sendMessage:function(t){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,echtzeit.URI.stringify(this.endpoint),t),this.batching?(this._promise=this._promise||new echtzeit.Promise,this._outbox.push(t),this._flushLargeBatch(),t.channel===echtzeit.Channel.HANDSHAKE?(this.addTimeout("publish",.01,this._flush,this),this._promise):(t.channel===echtzeit.Channel.CONNECT&&(this._connectMessage=t),this.addTimeout("publish",this.MAX_DELAY,this._flush,this),this._promise)):echtzeit.Promise.fulfilled(this.request([t]))},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),echtzeit.Promise.fulfill(this._promise,this.request(this._outbox)),delete this._promise,this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){var t=this.encode(this._outbox);if(!(t.length<this._dispatcher.maxRequestSize)){var e=this._outbox.pop();this._flush(),e&&this._outbox.push(e)}},_receive:function(t){t=[].concat(t),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,echtzeit.URI.stringify(this.endpoint),this.connectionType,t);for(var e=0,i=t.length;i>e;e++)this._dispatcher.handleResponse(t[e])},_handleError:function(t,e){t=[].concat(t),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,echtzeit.URI.stringify(this.endpoint),this.connectionType,t);for(var i=0,n=t.length;n>i;i++)this._dispatcher.handleError(t[i])},_getCookies:function(){var t=this._dispatcher.cookies,e=echtzeit.URI.stringify(this.endpoint);return t?echtzeit.map(t.getCookiesSync(e),function(t){return t.cookieString()}).join("; "):""},_storeCookies:function(t){var e,i=this._dispatcher.cookies,n=echtzeit.URI.stringify(this.endpoint);if(t&&i){t=[].concat(t);for(var s=0,r=t.length;r>s;s++)e=echtzeit.Cookies.Cookie.parse(t[s]),i.setCookieSync(e,n)}}}),{get:function(t,e,i,n,s){var r=t.endpoint;echtzeit.asyncEach(this._transports,function(r,o){var c=r[0],h=r[1],a=t.endpointFor(c);return echtzeit.indexOf(i,c)>=0?o():echtzeit.indexOf(e,c)<0?(h.isUsable(t,a,function(){}),o()):void h.isUsable(t,a,function(e){if(!e)return o();var i=h.hasOwnProperty("create")?h.create(t,a):new h(t,a);n.call(s,i)})},function(){throw new Error("Could not find a usable connection type for "+echtzeit.URI.stringify(r))})},register:function(t,e){this._transports.push([t,e]),e.prototype.connectionType=t},_transports:[]}),echtzeit.extend(echtzeit.Transport.prototype,echtzeit.Logging),echtzeit.extend(echtzeit.Transport.prototype,echtzeit.Timeouts),echtzeit.Event={_registry:[],on:function(t,e,i,n){var s=function(){i.call(n)};t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent("on"+e,s),this._registry.push({_element:t,_type:e,_callback:i,_context:n,_handler:s})},detach:function(t,e,i,n){for(var s,r=this._registry.length;r--;)s=this._registry[r],t&&t!==s._element||e&&e!==s._type||i&&i!==s._callback||n&&n!==s._context||(s._element.removeEventListener?s._element.removeEventListener(s._type,s._handler,!1):s._element.detachEvent("on"+s._type,s._handler),this._registry.splice(r,1),s=null)}},void 0!==echtzeit.ENV.onunload&&echtzeit.Event.on(echtzeit.ENV,"unload",echtzeit.Event.detach,echtzeit.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,s,r,o,c=gap,h=e[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(e,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(h)){for(r=h.length,i=0;r>i;i+=1)o[i]=str(i,h)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+c+"]":"["+o.join(",")+"]",gap=c,s}if(rep&&"object"==typeof rep)for(r=rep.length,i=0;r>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],s=str(n,h),s&&o.push(quote(n)+(gap?": ":":")+s));else for(n in h)Object.prototype.hasOwnProperty.call(h,n)&&(s=str(n,h),s&&o.push(quote(n)+(gap?": ":":")+s));return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+c+"}":"{"+o.join(",")+"}",gap=c,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;echtzeit.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})},"function"!=typeof JSON.stringify&&(JSON.stringify=echtzeit.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,n,s=t[e];if(s&&"object"==typeof s)for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n=walk(s,i),void 0!==n?s[i]=n:delete s[i]);return reviver.call(t,e,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),echtzeit.Transport.WebSocket=echtzeit.extend(echtzeit.Class(echtzeit.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)}),this.connect()},request:function(t){this._pending=this._pending||new echtzeit.Set;for(var e=0,i=t.length;i>e;e++)this._pending.add(t[e]);this.callback(function(e){e&&e.send(echtzeit.toJSON(t))},this),this.connect();var n=this;return{abort:function(){n.callback(function(t){t.close()})}}},connect:function(){if(!echtzeit.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var t=this._createSocket();if(!t)return this.setDeferredStatus("failed");
var e=this;t.onopen=function(){t.headers&&e._storeCookies(t.headers["set-cookie"]),e._socket=t,e._state=e.CONNECTED,e._everConnected=!0,e._ping(),e.setDeferredStatus("succeeded",t)};var i=!1;t.onclose=t.onerror=function(){if(!i){i=!0;var n=e._state===e.CONNECTED;t.onopen=t.onclose=t.onerror=t.onmessage=null,delete e._socket,e._state=e.UNCONNECTED,e.removeTimeout("ping"),e.setDeferredStatus("unknown");var s=e._pending?e._pending.toArray():[];delete e._pending,n?e._handleError(s,!0):e._everConnected?e._handleError(s):e.setDeferredStatus("failed")}},t.onmessage=function(t){var i=JSON.parse(t.data);if(i){i=[].concat(i);for(var n=0,s=i.length;s>n;n++)void 0!==i[n].successful&&e._pending.remove(i[n]);e._receive(i)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var t=echtzeit.Transport.WebSocket.getSocketUrl(this.endpoint),e=echtzeit.copyObject(this._dispatcher.headers),i={headers:e,ca:this._dispatcher.ca};return i.headers.Cookie=this._getCookies(),echtzeit.WebSocket?new echtzeit.WebSocket.Client(t,[],i):echtzeit.ENV.MozWebSocket?new MozWebSocket(t):echtzeit.ENV.WebSocket?new WebSocket(t):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(t,e){var i=t.transports.websocket=t.transports.websocket||{};return i[e.href]=i[e.href]||new this(t,e),i[e.href]},getSocketUrl:function(t){return t=echtzeit.copyObject(t),t.protocol=this.PROTOCOLS[t.protocol],echtzeit.URI.stringify(t)},isUsable:function(t,e,i,n){this.create(t,e).isUsable(i,n)}}),echtzeit.extend(echtzeit.Transport.WebSocket.prototype,echtzeit.Deferrable),echtzeit.Transport.register("websocket",echtzeit.Transport.WebSocket),echtzeit.Event&&void 0!==echtzeit.ENV.onbeforeunload&&echtzeit.Event.on(echtzeit.ENV,"beforeunload",function(){echtzeit.Transport.WebSocket._unloaded=!0}),echtzeit.Transport.EventSource=echtzeit.extend(echtzeit.Class(echtzeit.Transport,{initialize:function(t,e){if(echtzeit.Transport.prototype.initialize.call(this,t,e),!echtzeit.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new echtzeit.Transport.XHR(t,e),e=echtzeit.copyObject(e),e.pathname+="/"+t.clientId;var i=new EventSource(echtzeit.URI.stringify(e)),n=this;i.onopen=function(){n._everConnected=!0,n.setDeferredStatus("succeeded")},i.onerror=function(){n._everConnected?n._handleError([]):(n.setDeferredStatus("failed"),i.close())},i.onmessage=function(t){n._receive(JSON.parse(t.data))},this._socket=i},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)})},encode:function(t){return this._xhr.encode(t)},request:function(t){return this._xhr.request(t)}}),{isUsable:function(t,e,i,n){var s=t.clientId;return s?void echtzeit.Transport.XHR.isUsable(t,e,function(s){return s?void this.create(t,e).isUsable(i,n):i.call(n,!1)},this):i.call(n,!1)},create:function(t,e){var i=t.transports.eventsource=t.transports.eventsource||{},n=t.clientId;e=echtzeit.copyObject(e),e.pathname+="/"+(n||"");var s=echtzeit.URI.stringify(e);return i[s]=i[s]||new this(t,e),i[s]}}),echtzeit.extend(echtzeit.Transport.EventSource.prototype,echtzeit.Deferrable),echtzeit.Transport.register("eventsource",echtzeit.Transport.EventSource),echtzeit.Transport.XHR=echtzeit.extend(echtzeit.Class(echtzeit.Transport,{encode:function(t){return echtzeit.toJSON(t)},request:function(t){var e=this.endpoint.href,i=echtzeit.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,n=this;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Pragma","no-cache"),i.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=this._dispatcher.headers;for(var r in s)s.hasOwnProperty(r)&&i.setRequestHeader(r,s[r]);var o=function(){i.abort()};return void 0!==echtzeit.ENV.onbeforeunload&&echtzeit.Event.on(echtzeit.ENV,"beforeunload",o),i.onreadystatechange=function(){if(i&&4===i.readyState){var e=null,s=i.status,r=i.responseText,c=s>=200&&300>s||304===s||1223===s;if(void 0!==echtzeit.ENV.onbeforeunload&&echtzeit.Event.detach(echtzeit.ENV,"beforeunload",o),i.onreadystatechange=function(){},i=null,!c)return n._handleError(t);try{e=JSON.parse(r)}catch(h){}e?n._receive(e):n._handleError(t)}},i.send(this.encode(t)),i}}),{isUsable:function(t,e,i,n){i.call(n,echtzeit.URI.isSameOrigin(e))}}),echtzeit.Transport.register("long-polling",echtzeit.Transport.XHR),echtzeit.Transport.CORS=echtzeit.extend(echtzeit.Class(echtzeit.Transport,{encode:function(t){return"message="+encodeURIComponent(echtzeit.toJSON(t))},request:function(t){var e,i=echtzeit.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,n=new i,s=this._dispatcher.headers,r=this;if(n.open("POST",echtzeit.URI.stringify(this.endpoint),!0),n.setRequestHeader){n.setRequestHeader("Pragma","no-cache");for(e in s)s.hasOwnProperty(e)&&n.setRequestHeader(e,s[e])}var o=function(){return n?(n.onload=n.onerror=n.ontimeout=n.onprogress=null,void(n=null)):!1};return n.onload=function(){var e=null;try{e=JSON.parse(n.responseText)}catch(i){}o(),e?r._receive(e):r._handleError(t)},n.onerror=n.ontimeout=function(){o(),r._handleError(t)},n.onprogress=function(){},n.send(this.encode(t)),n}}),{isUsable:function(t,e,i,n){if(echtzeit.URI.isSameOrigin(e))return i.call(n,!1);if(echtzeit.ENV.XDomainRequest)return i.call(n,e.protocol===echtzeit.ENV.location.protocol);if(echtzeit.ENV.XMLHttpRequest){var s=new echtzeit.ENV.XMLHttpRequest;return i.call(n,void 0!==s.withCredentials)}return i.call(n,!1)}}),echtzeit.Transport.register("cross-origin-long-polling",echtzeit.Transport.CORS),echtzeit.Transport.JSONP=echtzeit.extend(echtzeit.Class(echtzeit.Transport,{encode:function(t){var e=echtzeit.copyObject(this.endpoint);return e.query.message=echtzeit.toJSON(t),e.query.jsonp="__jsonp"+echtzeit.Transport.JSONP._cbCount+"__",echtzeit.URI.stringify(e)},request:function(t){var e=document.getElementsByTagName("head")[0],i=document.createElement("script"),n=echtzeit.Transport.JSONP.getCallbackName(),s=echtzeit.copyObject(this.endpoint),r=this;s.query.message=echtzeit.toJSON(t),s.query.jsonp=n;var o=function(){if(!echtzeit.ENV[n])return!1;echtzeit.ENV[n]=void 0;try{delete echtzeit.ENV[n]}catch(t){}i.parentNode.removeChild(i)};return echtzeit.ENV[n]=function(t){o(),r._receive(t)},i.type="text/javascript",i.src=echtzeit.URI.stringify(s),e.appendChild(i),i.onerror=function(){o(),r._handleError(t)},{abort:o}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(t,e,i,n){i.call(n,!0)}}),echtzeit.Transport.register("callback-polling",echtzeit.Transport.JSONP),"undefined"!=typeof module?module.exports=echtzeit:"undefined"!=typeof window&&(window.echtzeit=echtzeit);